$((function(){!function(t){Date.prototype.addDays=function(t){var a=new Date(this.valueOf());return a.setDate(a.getDate()+t),a};var a=new Date,e=a.getDay();function i(){var t=[];listCombo=[];for(var a=0;a<count_list;a++)for(var e=list_kubun[a],i=e.type_holiday,n=0;n<1;n++){var r="cmb_"+i+"_"+e.time_holiday,s="tr_"+i+"_"+e.time_holiday;listCombo.push(r);var c="                             <tr id='"+s+"'>                                 <td class='name_holiday'>"+e.kubun_value+"</td>                                 <td class='value_holiday' align='right'>                                     <div class='checkbox-container'>                                         <input type='checkbox' id='"+r+"' name='"+r+"' checked>                                     </div>                                 </td>                             </tr>";null==t[i]?t[i]=c:t[i]+=c,"1"==i&&(i="4",n--)}t.forEach(l),listCombo.forEach(o)}function l(a,e){var i="<table>"+a+"</table>";t("#div"+e).html(i)}3==e||4==e?a=3==e?a.addDays(2):a.addDays(1):(first_page=!1,i()),t("#go-day").off("click"),t("#go-day").on("click",(function(t){var a=$curent_url.substring(0,$curent_url.length-8)+"day";window.location.href=a})),t("#go-weekly").off("click"),t("#go-weekly").on("click",(function(t){var a=$curent_url.substring(0,$curent_url.length-8)+"weekly";window.location.href=a})),t("#go-monthly").off("click"),t("#go-monthly").on("click",(function(t){var a=$curent_url.substring(0,$curent_url.length-8)+"monthly";window.location.href=a})),t("#show_current_date").datepicker({language:"ja",weekStart:1,daysOfWeekDisabled:"3,4",datesDisabled:_date_holiday,dateFormat:"yyyy/mm/dd"}).on("changeDate",(function(a){var e,l,n;if(e=a.date,l=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),t("#date_search").val(l),first_page)return i(),void(first_page=!1);t.ajax({url:$site_url+"/admin/ajax_time_off",type:"POST",data:{date_search:t("#date_search").val()},dataType:"JSON",beforeSend:function(){loader.css({display:"block"})},success:function(t){1==t.status&&(t.data,list_kubun=t.data.list_kubun,list_holiday=t.data.list_holiday,count_list=list_kubun.length,count_holiday=list_holiday.length,i())},complete:function(){loader.css({display:"none"})}}),(n=r()).date_search<n.date_now?t("#submitButton").addClass("disabled"):t("#submitButton").removeClass("disabled")})).datepicker("setDate",a),t(document).on("click","#submitButton",(function(a){a.preventDefault();for(var e=[],i=listCombo.length,l=0;l<i;l++){var n="#"+listCombo[l];"off"==t(n).val()&&e.push(listCombo[l].replace("cmb_",""))}t.ajax({url:$site_url+"/admin/submit_time_off",type:"POST",data:{date_search:t("#date_search").val(),data:e},dataType:"JSON",beforeSend:function(){loader.css({display:"block"})},success:function(t){1==t.status&&alert("保存に成功しました。")},complete:function(){loader.css({display:"none"})}})}));var n=!1;function o(a,e){!function(a){for(var e="#"+a,i=a.split("_"),l=i[1],n=i[2],o=0;o<count_holiday;o++){var r=list_holiday[o];if(r.type_holiday==l&&r.time_holiday==n){t(e).click(),t(e).val("off");var s=e.replace("cmb_","tr_");t(s).addClass("tr_disable");break}}}(a),new DG.OnOffSwitch({el:"#"+a,height:20,textOn:"ON",textOff:"OFF",listener:function(a,e){if(n)n=!1;else{var i=r(),l=!1;if(i.date_search==i.date_now){var o=new Date,s=o.getHours(),c=o.getMinutes();c<10&&(c="0"+c);var d=parseInt(""+s+c),u=a.split("_");d>=parseInt(u[u.length-1])&&(l=!0)}if(i.date_search<i.date_now||l){var _=a.split("_");_.length>2&&"5"==_[1]?l=!1:(this.checked?this.animateLeft():this.animateRight(),alert("休日が未来の日付のみに設定できます。"),n=!0)}if(!l){var f="#"+a.replace("cmb_","tr_");e?(t("#"+a).val("on"),t(f).removeClass("tr_disable")):(t("#"+a).val("off"),t(f).addClass("tr_disable"))}}}})}function r(){var a=(new Date).toISOString().slice(0,10);a=a.replace(/-/g,"");var e=t("#date_search").val(),i=(e=e.split("-"))[2].length<2?"0"+e[2]:e[2],l=e[1].length<2?"0"+e[1]:e[1];return{date_now:a,date_search:e=e[0]+l+i}}}(jQuery)}));